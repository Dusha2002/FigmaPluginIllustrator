# Экспорт PDF с векторными и растровыми элементами

## Описание

Реализован экспорт в PDF с сохранением векторных элементов в формате CMYK. Плагин автоматически определяет тип элементов в Figma и экспортирует:
- **Векторные элементы** → SVG (сохраняются как векторные объекты в PDF)
- **Растровые элементы** → PNG (конвертируются в CMYK и встраиваются в PDF)

Итоговый PDF можно редактировать в Adobe Illustrator или CorelDRAW.

## Что изменено

### Клиентская часть (Figma Plugin)

#### `code.js`
- Добавлены функции `isVectorNode()` и `hasRasterEffects()` для определения типа элементов
- Модифицирована функция `exportSelection()`:
  - Векторные элементы экспортируются как SVG
  - Растровые элементы и элементы с эффектами экспортируются как PNG
  - Каждый элемент помечается флагом `isVector`

#### `ui.html`
- Модифицирована функция `exportViaServer()`:
  - Для PDF с несколькими элементами отправляет все файлы одним запросом
  - Для каждого элемента передаются метаданные (ширина, высота)
- Модифицирована функция `processExportResult()`:
  - При экспорте PDF с несколькими элементами объединяет их в один файл
  - Для TIFF элементы экспортируются отдельно

### Серверная часть (Java)

#### `ExportRequest.java`
- Добавлены поля `widthPxMap` и `heightPxMap` для хранения метаданных множественных файлов
- Добавлены методы для работы с метаданными по индексу элемента

#### `ExportController.java`
- Расширен для приёма как одиночного файла (`image`), так и множественных (`images`)
- Добавлена обработка параметров `widthPx_N` и `heightPx_N` из HTTP-запроса

#### `ExportService.java`
- Добавлен метод `convertMultiple()` для обработки множественных файлов
- Добавлен метод `convertMultipleToPdf()`:
  - Обрабатывает каждый файл (SVG или PNG) отдельно
  - Создаёт PDF-страницу для каждого элемента
  - Объединяет все страницы в один PDF-документ
  - Применяет ICC-профиль Coated FOGRA39 для CMYK

## Как использовать

1. Выберите несколько элементов в Figma (векторные и/или растровые)
2. Выберите формат "PDF" в плагине
3. Нажмите "Экспортировать"
4. Плагин создаст один PDF-файл со всеми элементами:
   - Векторные элементы останутся редактируемыми
   - Растровые элементы будут в CMYK
   - Файл можно открыть в Illustrator/CorelDRAW для редактирования

## Типы элементов

### Векторные (экспортируются как SVG):
- VECTOR, LINE, ELLIPSE, POLYGON, STAR, RECTANGLE
- TEXT, FRAME, GROUP
- COMPONENT, INSTANCE, BOOLEAN_OPERATION

### Растровые (экспортируются как PNG):
- IMAGE
- Любые элементы с эффектами: DROP_SHADOW, INNER_SHADOW, LAYER_BLUR, BACKGROUND_BLUR

## API

### Endpoint: `/convert`

#### Одиночный файл:
```
POST /convert
Content-Type: multipart/form-data

- image: файл (SVG или PNG)
- format: "pdf" или "tiff"
- name: имя файла
- ppi: разрешение
- widthPx, heightPx: размеры
```

#### Множественные файлы (только PDF):
```
POST /convert
Content-Type: multipart/form-data

- images: массив файлов (SVG и/или PNG)
- format: "pdf"
- name: имя файла
- ppi: разрешение
- widthPx_0, heightPx_0: размеры первого элемента
- widthPx_1, heightPx_1: размеры второго элемента
- ...
```

## Технические детали

- **ICC-профиль**: Coated FOGRA39
- **Версия PDF**: 1.4
- **Цветовое пространство**: CMYK
- **Векторный рендеринг**: Apache Batik + PdfBoxGraphics2D
- **Растровая обработка**: ImageIO + Java2D

## Ограничения

- Множественные файлы поддерживаются только для PDF
- Для TIFF каждый элемент экспортируется отдельным файлом
- Максимальный размер файла: 200 МБ (настраивается в `application.properties`)
